
<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Winter Olympics Medal Table</title>

<style>

html, body {
  margin:0;
  height:100%;
  background:#05070c;
  font-family: "Segoe UI", Roboto, system-ui, sans-serif;
  color:#fff;
  overflow:hidden;
}

/* Studio Background */
.frame {
  width:100%;
  aspect-ratio:22 / 9;
  margin:0 auto;
  padding:2.5vw;
  box-sizing:border-box;
  display:flex;
  flex-direction:column;
  position:relative;
  background:
    radial-gradient(circle at 20% 10%, rgba(0,80,255,0.2), transparent 40%),
    radial-gradient(circle at 80% 90%, rgba(255,215,0,0.15), transparent 40%),
    linear-gradient(180deg,#0b1326 0%,#05070c 100%);
  border:0.4vw solid rgba(255,255,255,0.08);
  box-shadow:0 0 60px rgba(0,0,0,0.7);
}

/* Subtle Vignette */
.frame::after {
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:radial-gradient(circle at center, transparent 60%, rgba(0,0,0,0.6) 100%);
}

.header {
  text-align:center;
  margin-bottom:2vmin;
}

.title {
  font-size:3.0vw;
  font-weight:800;
  letter-spacing:2px;
  margin-top:1vmin;
}

/* Header Row */
.headerRow {
  display:grid;
  grid-template-columns:6vw 52.5fr 1fr 1fr 1fr 1.2fr;
  margin-bottom:1vmin;
  font-size:2.6vw;
  font-weight:900;
  text-align: right; 
  text-transform:uppercase;
  letter-spacing:1px;
  background:linear-gradient(90deg,rgba(255,255,255,0.08),rgba(255,255,255,0.02));
  border-bottom:1px solid rgba(255,255,255,0.2);
  align-items:center;
}
  
/* Header Medal Styling */
.headerRow .cell {
  font-size: 3.0vw;
  text-align: right;     /* <-- key fix */
  padding-right: 0.2vw;  /* tiny nudge so it visually matches numbers */
  animation: medalFloat 3s ease-in-out infinite;
}

.headerRow .cell:nth-child(3) { animation-delay: 0s; }
.headerRow .cell:nth-child(4) { animation-delay: .3s; }
.headerRow .cell:nth-child(5) { animation-delay: .6s; }

.headerRow .gold   { text-shadow: 0 0 15px rgba(255,215,0,.6); }
.headerRow .silver { text-shadow: 0 0 12px rgba(255,255,255,.6); }
.headerRow .bronze { text-shadow: 0 0 12px rgba(198,134,66,.6); }


@keyframes medalFloat {
  0%   { transform: translateY(0px) scale(1); }
  50%  { transform: translateY(-6px) scale(1.1); }
  100% { transform: translateY(0px) scale(1); }
}

.table {
  flex:1;
  display:flex;
  flex-direction:column;
  gap:1.2vmin;
  position:relative;
  z-index:2;
}

.row {
  display:grid;
  grid-template-columns:6vw 2.5fr 1fr 1fr 1fr 1.2fr;
  padding:2vmin;
  align-items:center;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.08);
  transition:transform .6s cubic-bezier(.2,.8,.2,1), box-shadow .4s ease;
}

.rank {
  font-size:2vw;
  font-weight:900;
}

.country {
  display:flex;
  align-items:center;
  perspective: 800px;
  font-size:3vw;
  font-weight:700;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}


.cell {
  text-align:right;
  font-size:2.6vw;
  font-weight:800;
}

.cell.gold { color:#FFD700; }
.cell.silver { color:#D6D6D6; }
.cell.bronze { color:#C68642; }

.flag {
  width:4vw;
  border-radius:2px;
  transform-origin:left center;
  animation:wave 3s ease-in-out infinite;
  backface-visibility:hidden;
}

@keyframes wave {
  0%   { transform: skewX(0deg); }
  50%  { transform: skewX(8deg); }
  100% { transform: skewX(0deg); }
}


.total {
  font-size:3vw;
}

.liveBug {
  position:absolute;
  top:2vmin;
  right:3vmin;
  font-size:1vw;
  font-weight:700;
  letter-spacing:1px;
  display:flex;
  align-items:center;
  gap:0.6vmin;
}

.liveDot {
  width:.6vw;
  height:.6vw;
  background:red;
  border-radius:50%;
  animation:pulseLive 1.5s infinite;
}

@keyframes pulseLive {
  0% { opacity:1; transform:scale(1); }
  50% { opacity:.4; transform:scale(1.5); }
  100% { opacity:1; transform:scale(1); }
}

.leaderGlow {
 box-shadow:
  0 0 25px rgba(255,215,0,0.5),
  0 0 60px rgba(255,215,0,0.15);
}

.flash {
  animation:flash 0.4s ease;
}

@keyframes flash {
  0% { background:rgba(255,255,255,0.3); }
  100% { background:transparent; }
}

.footer {
  font-size:1vw;
  opacity:0.7;
  margin-top:2vmin;
  text-align:center;
}

</style>

</head>

<body>

<div class="frame">

<div class="liveBug">
  <div class="liveDot"></div>
  LIVE
</div>


  <div class="header">
    <svg viewBox="0 0 300 130" style="width:10vw; opacity:0.9;">
  <circle cx="60" cy="65" r="30" stroke="#0085C7" stroke-width="8" fill="none"/>
  <circle cx="120" cy="65" r="30" stroke="#000000" stroke-width="8" fill="none"/>
  <circle cx="180" cy="65" r="30" stroke="#DF0024" stroke-width="8" fill="none"/>
  <circle cx="90" cy="95" r="30" stroke="#F4C300" stroke-width="8" fill="none"/>
  <circle cx="150" cy="95" r="30" stroke="#009F3D" stroke-width="8" fill="none"/>
</svg>
    <div class="title">2026 Winter Olympics Medal Count</div>
  </div>

  <div class="table">

  <div class="row headerRow" style="opacity:1; background:none; border:none; animation:fadeSlide 0.6s">
    <div></div>
    <div>Country</div>
    <div class="cell gold">ü•á</div>
    <div class="cell silver">ü•à</div>
    <div class="cell bronze">ü•â</div>
    
    <div>   Total</div>
  </div>

  <div id="rows"></div>

</div>

  <div id="status" class="footer">Loading‚Ä¶</div>

</div>

<script>

const API = "https://script.google.com/macros/s/AKfycby3rRAJqUmgRc_pfnlrtjWx7Yof3IvhugY_-f7BxYjeksL5-eNRX67QXhTkIqvhmr4o/exec";

const iocToIso2 = {
  USA:"US", ITA:"IT", NOR:"NO", NED:"NL", AUT:"AT",
  GER:"DE", FRA:"FR", CAN:"CA", JPN:"JP", SUI:"CH",
  SWE:"SE", FIN:"FI", GBR:"GB", KOR:"KR", CHN:"CN"
};

let previousData = {};
let lastTop5Snapshot = "";


function animateCount(el, start, end, duration=600) {
  const startTime = performance.now();
  function update(now) {
    const progress = Math.min((now - startTime)/duration, 1);
    el.textContent = Math.floor(progress*(end-start)+start);
    if(progress < 1) requestAnimationFrame(update);
  }
  requestAnimationFrame(update);
}

function flash(el) {
  el.style.transition = "background .3s ease";
  el.style.background = "rgba(255,255,255,0.25)";
  setTimeout(()=> el.style.background="transparent", 300);
}

async function load() {

  const container = document.getElementById("rows");
  const status = document.getElementById("status");

  try {
    const res = await fetch(API);
    const data = await res.json();

    // Make a stable snapshot string of top5 (only the fields that matter)
    const snapshot = (data.top5 || [])
    .map(r => `${r.code}:${r.rank}:${r.gold}:${r.silver}:${r.bronze}:${r.total}`)
    .join("|");
    if (snapshot === lastTop5Snapshot) {
  // Still update the timestamp so you know it‚Äôs alive
    status.textContent = "‚óè LIVE  |  Updated: " + new Date(data.updatedAt).toLocaleString();
    return;
    }

    lastTop5Snapshot = snapshot;

    const usa = data.top5.find(r => r.code === "USA");
    const usaTotal = usa ? usa.total : 0;

    const fragment = document.createDocumentFragment();

    data.top5.forEach((r) => {

      let row = document.getElementById("row_" + r.code);

      if(!row) {
        row = document.createElement("div");
        row.className = "row";
        row.id = "row_" + r.code;
        row.style.transition = "transform .6s ease, box-shadow .4s ease";
      }

      const iso = iocToIso2[r.code] || "";
      const flag = iso
        ? `<img class="flag" src="https://flagcdn.com/w40/${iso.toLowerCase()}.png"
           style="vertical-align:middle;margin-right:8px;border-radius:4px;">`
        : "";

        if(r.rank === 1) row.classList.add("leaderGlow");
        else row.classList.remove("leaderGlow");

      const highlight = r.code === "USA"
        ? "background:rgba(0,80,255,0.2); border-color:rgba(255,255,255,0.5);"
        : "";

      const delta = r.total - usaTotal;
      const deltaDisplay = r.code === "USA"
        ? ""
        : `<div style="font-size:1vw; opacity:.5;">${delta>0? "+"+delta : delta}</div>`;

      row.style.cssText = highlight;

      row.innerHTML = `
        <div class="rank">${r.rank}</div>
        <div class="country">${flag}${r.name}</div>
        <div class="cell gold"><span class="count" data-type="gold">${r.gold}</span></div>
        <div class="cell silver"><span class="count" data-type="silver">${r.silver}</span></div>
        <div class="cell bronze"><span class="count" data-type="bronze">${r.bronze}</span></div>
        <div class="cell total">
          <span class="count" data-type="total">${r.total}</span>
          ${deltaDisplay}
        </div>
      `;

      const prev = previousData[r.code];

      if(prev) {
        ["gold","silver","bronze","total"].forEach(type=>{
        if(r[type] > prev[type]) {
          const el = row.querySelector(`[data-type="${type}"]`);
          el.classList.add("flash");
          setTimeout(()=> el.classList.remove("flash"), 400);
        }

        });
      }

      previousData[r.code] = r;

      fragment.appendChild(row);
    });

    container.innerHTML = "";
    container.appendChild(fragment);

    status.textContent = "‚óè LIVE  |  Updated: " + new Date(data.updatedAt).toLocaleString();

  } catch(err) {
    console.error(err);
    status.textContent = "Data load failed";
  }
}

load();
setInterval(load, 60000);

</script>



</body>
</html>

